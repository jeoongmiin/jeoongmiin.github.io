# 28일차 TIL

## 서브 쿼리

### FROM 절

FROM절의 서브 쿼리의 경우 서브 쿼리의 결과를 마치 가상의 테이블처럼 사용할 수 있다.

```sql
-- 데이터베이스, 알고리즘 수강 정보 조회
SELECT *
FROM
	(
		SELECT name, class_name
		FROM classes
		WHERE class_name IN ('데이터베이스', '알고리즘')
	) as c
```

### WHERE 절

```sql
-- 데이터베이스, 알고리즘을 수강하는 학생의 이름, 나이 주소 조회
SELECT name, age, address
FROM students
WHERE name IN (
	SELECT name
	FROM classes
	WHERE class_name IN ('데이터베이스', '알고리즘')
)
```

## DDL (Data Definition Language)

- 데이터를 어떻게 저장할 지 전체적인 골격을 결정하는 역할
- 테이블 생성 뿐만 아니라 테이블 구조를 바꾸는 역할도 한다.

| CREATE | 새로운 테이블을 생성 |
| --- | --- |
| ALTER | 기존 테이블 구조 변경 |
| DROP | 테이블 삭제 |
| RENAME | 기존 테이블 이름 변경 |
| TRUNCATE | 기존 테이블 초기화 |

## CREATE

### 데이터베이스

![Untitled](https://github.com/jeoongmiin/jeoongmiin.github.io/assets/100908119/7943a1d0-a4ce-451d-a2e3-fca0b16040da)

DBMS에는 여러 개의 데이터베이스를 만들 수 있고, 데이터베이스 하위에 여러 개의 테이블을 만들 수 있는 계층 구조이다. 데이터베이스를 여러 개만드는 이유 중 하나는 각 데이터베이스마다 접근 권한을 다르게 설정할 수 있기 때문이다.

```sql
-- 데이터베이스 생성
CREATE DATABASE [데이터베이스명]

-- 테이블 생성
CREATE TABLE [데이터베이스이름].[테이블이름] (
	[열] [데이터타입] [제약조건],
	...
)
```

| 데이터베이스 이름 | 어떤 데이터베이스 하위에 테이블을 생성할 지 |
| --- | --- |
| 테이블 이름 | 생성하려는 테이블의 이름 |
| 열 | 열의 이름 |
| 데이터 타입 | 해당 열의 데이터 타입 (ex. 정수, 문자열, 날짜, …) |
| 제약조건 | [NOT NULL | DEFAULT | PRIMARY KEY] 등의 옵션을 줄 수 있습니다. |
- 주로 사용하는 데이터 타입

| 데이터 타입 | 설명 |
| --- | --- |
| CHAR(size) | 고정된 길이의 문자열 저장 |
| VARCHAR(size) | 가변 길이의 문자열 저장 |
| INT | 정수형 데이터 저장 |
| FLOAT | 실수형 데이터 저장 |
| DATE | 날짜 저장 |
| TIME | 시간 저장 |
| TIMESTAMP | 날짜와 시간 저장 |

### 테이블 제약조건(Constraint)

- `Constraint` : 테이블에 부적절한 데이터가 입력되는 것을 방지하기 위해 테이블 생성 시점에 규칙을 정해놓는 것
- 컬럼 단위로 정해지는 규칙이고, 해당 컬럼에 입력되는 데이터의 성격을 정해놓는 것

| 옵션 | 설명 |
| --- | --- |
| NOT NULL | 해당 열에 NULL 값을 허용하지 않는다 |
| DEFAULT | 데이터를 입력 시 해당 열에 아무런 값도 입력되지 않은 경우 기본으로 사용할 값 지정 |
| UNIQUE | 해당 테이블 내에서 유일한 속성을 갖는다는 의미로, UNIQUE로 설정된 열에는 중복된 값을 저장할 수 없다 |
| PRIMARY KEY | 하나의 테이블에 있는 데이터들을 식별하기 위한 기준 |
| FOREIGN KEY(외래키) | 테이블간에 관계를 나타낼 때 사용하는 Key로, 다른 테이블의 기본키를 참조해 외래키로 사용한다 |

### NOT NULL 제약조건

- 테이블 생성 시 해당 열에 NULL값을 허용하지 않는다
- NOT NULL 제약조건이 없다면 default는 NULL 허용

```sql
CREATE TABLE 테이블명 (
		컬럼명 데이터타입 **NOT NULL**
		...
)
```

### UNIQUE 제약조건

- 테이블의 컬럼 그룹에 대해 유일한 값이어야 한다
- 데이터 무결성을 유지하는 데 도움이 되며, 일반적으로 고유한 식별자를 갖는 열에 많이 사용된다.

```sql
CREATE TABLE 테이블명 (
		컬럼명 데이터타입 **UNIQUE** 
		...
)
```

### DEFAULT

- 테이블의 컬럼에 대해 값을 명시적으로 제공하지 않을 경우 사용되는 컬럼 기본 값 지정
- 테이블에 새로운 행을 삽입할 때 해당 컬럼에 값을 지정하지 않는 경우 그 컬럼에 DEFAULT 값을 자동으로 할당한다

```sql
CREATE TABLE 테이블명 (
		컬럼명 데이터타입 DEFAULT 기본값
		...
) 
```

### PRIMARY KEY (기본키)

- 하나의 테이블에 있는 데이터들을 식별하기 위한 기준
- 하나의 테이블에 하나의 기본키만 생성이 가능하고, 기본키는 하나 이상의 컬럼으로 구성이 가능하다.
- 기본적으로 NULL 값을 가질 수 없으며 중복된 값을 가져서도 안된다.

```sql
CREATE TABLE 테이블명 (
		컬럼명 데이터타입 PRIMARY KEY
		...
) 
```

### FOREIGN KEY (외래키)

- 테이블 간의 관계를 나타낼 때 사용하는 키로 다른 테이블의 기본키를 참조해 외래키로 사용한다.
- 외래키 설정 시 옵션
    1. RESTRICT
        
        대부분의 DBMS 시스템에서는 DEFAULT 설정으로 RESTRICT가 적용된다. 일반적으로 데이터 무결성을 유지하기 위해 가장 안전한 옵션이며 외래키 제약조건이 설정된 경우 참조된 행이 삭제되는 것을 방지하여 데이터 일관성을 유지한다.
        
        ![Untitled 1](https://github.com/jeoongmiin/jeoongmiin.github.io/assets/100908119/7172a2b3-9429-4dfc-920d-5d4bb90bc823)
        
        RESTRICT 제약 조건을 사용하게 되는 경우, 자식 테이블의 모든 레코드를 삭제해야만 부모 테이블의 레코드를 삭제할 수 있다.
        
        ![Untitled 2](https://github.com/jeoongmiin/jeoongmiin.github.io/assets/100908119/b19f99e6-7444-4c56-ad8a-a7c1b487f5da)
        
    2. CASCADE
        
        이 옵션을 설정하면 참조된 부모 테이블에 대한 DELETE를 허용한다. 참조된 테이블의 레코드가 삭제될 때 해당 레코드를 참조하는 다른 테이블의 레코드도 함께 삭제된다. 
        
        ![Untitled 3](https://github.com/jeoongmiin/jeoongmiin.github.io/assets/100908119/7278d369-2120-49d1-8959-b7cf088580c0)
        
    3. SET NULL
        
        이 옵션을 설정하면 부모 테이블의 정보가 삭제되었을 때 이를 참고하고 있던 자식 테이블의 컬럼값이 NULL로 변경된다.
        
        ![Untitled 4](https://github.com/jeoongmiin/jeoongmiin.github.io/assets/100908119/5fe512f6-acb6-4338-824e-823ba097f696)
        
- 외래키는 데이터의 무결성을 위해 사용하지만 테이블간의 의존도를 높여 추후 데이터를 수작업으로 다룰 경우 변경에 불리하게 작용된다.
- 보통은 외래키를 따로 설정하지 않고, 애플리케이션 코드 레벨에서 데이터의 일관성을 확인한다. 참조 관계에 있는 테이블을 명시만 하되, 실제 테이블간의 의존도는 낮추고 개발자의 자유도를 높이는 방법이다.

## ALTER

- 기존 테이블의 구조를 변경하기위해 사용
- 테이블에 데이터가 쌓여있는 상태에서 구조를 변경하면 예기치 못한 이슈가 발생할 수 있다.

```sql
-- 새로운 열 추가
ALTER TABLE students ADD grade VARCHAR(20)

-- 기존 열 이름 변경
ALTER TABLE students RENAME COLUMN grade TO great

-- 기존 열 데이터 타입 변경
ALTER TABLE students MODIFY COLUMN address VARCHAR(100)

-- 열 삭제
ALTER TABLE students DROP COLUMN grade
```

## DROP

- 테이블을 삭제할 때 사용
- 삭제할 테이블이 올바른지 반드시 확인하고 실행해야 한다.

```sql
DROP TABLE test_db.students
```

## TRUNCATE

- 테이블의 모든 데이터를 삭제
- 최초 생성된 테이블 초기 상태로 만들어준다.

```sql
TRUNCATE TABLE students
```

## **W3Schools MySQL 연습**

![Untitled 5](https://github.com/jeoongmiin/jeoongmiin.github.io/assets/100908119/03566fee-ec96-46ce-a423-6350dd4f199e)